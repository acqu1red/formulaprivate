<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìÇ –ê—Ä—Ö–∏–≤—ã –ö–æ–Ω—Ç—Ä–æ–ª—è - –¢–∞–π–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è</title>
  <link rel="stylesheet" href="quests-black-white.css">
</head>
<body>
  <div id="app" class="app">
    <header class="glass topbar">
      <div class="brand">
        <span class="logoGlow"></span>
        <h1>üìÇ –ê—Ä—Ö–∏–≤—ã –ö–æ–Ω—Ç—Ä–æ–ª—è</h1>
        <div class="badge">–†–∞—Å—Å–µ–∫—Ä–µ—á–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã</div>
      </div>
      <div class="actions">
        <button id="btnBack" class="btn ghost">‚Üê –ù–∞–∑–∞–¥</button>
      </div>
    </header>

    <div class="quest-container">
      <div class="quest-header">
        <h2>üîç –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –ê—Ä—Ö–∏–≤—ã –ö–æ–Ω—Ç—Ä–æ–ª—è</h2>
        <div class="theme">–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
      </div>

      <div class="quest-content">
        <div class="banner">
          <strong>–ú–∏—Å—Å–∏—è:</strong> –ò–∑—É—á–∏—Ç–µ —Ä–∞—Å—Å–µ–∫—Ä–µ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ä–∞—Å–∫—Ä–æ–π—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —ç–ª–∏—Ç—ã.
        </div>

        <div class="achievement-display" id="questComplete" style="display: none;">
          <div class="achievement-icon">üî∫</div>
          <h3>–ó–∞–≥–æ–≤–æ—Ä —Ä–∞—Å–∫—Ä—ã—Ç!</h3>
          <p>–í—ã —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏ —Ä–∞—Å–∫—Ä—ã–ª–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è.</p>
          <div class="rewards">
            <div class="reward">+5 <span>Mulacoin</span></div>
            <div class="reward">+1000 <span>–æ–ø—ã—Ç–∞</span></div>
          </div>
          <button id="finishBtn" class="btn primary">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/telegram-web-app.js"></script>
  <script src="../js/supabase.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('btnBack').addEventListener('click', () => {
        window.location.href = '../quests.html';
      });

      document.getElementById('finishBtn').addEventListener('click', async () => {
        try {
          if (window.supabase && window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
            const userId = window.Telegram.WebApp.initDataUnsafe.user.id;
            
            await window.supabase
              .from('quest_completions')
              .insert({
                user_id: userId,
                quest_id: 'control-archives',
                completed_at: new Date().toISOString(),
                reward_fragments: 5,
                reward_experience: 1000
              });

            await window.supabase.rpc('add_user_rewards', {
              p_user_id: userId,
              p_fragments: 5,
              p_experience: 1000
            });
          }
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
        }

        window.location.href = '../quests.html';
      });

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
      setTimeout(() => {
        document.getElementById('questComplete').style.display = 'block';
      }, 1000);
    });
  </script>
</body>
</html>