<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–Ø–∑—ã–∫ —Ç–µ–ª–∞ ‚Äî –ö–≤–µ—Å—Ç‚Äë–•–∞–±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../quests.css" />
  <style>
    .bodylang-quest {
      position: relative;
      min-height: 100vh;
      background: linear-gradient(135deg, #0B1020 0%, #1A2332 100%);
      overflow: hidden;
    }
    
    .character-container {
      position: relative;
      width: 100%;
      height: 300px;
      border-radius: var(--radius);
      overflow: hidden;
      margin: 20px 0;
      background: var(--bg1);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .character {
      position: relative;
      width: 120px;
      height: 200px;
      transition: all 0.5s ease;
    }
    
    .character-body {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 120px;
      background: linear-gradient(180deg, #4A5568 0%, #2D3748 100%);
      border-radius: 30px 30px 20px 20px;
      border: 2px solid #1A202C;
    }
    
    .character-head {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 50px;
      background: linear-gradient(180deg, #F7FAFC 0%, #E2E8F0 100%);
      border-radius: 50%;
      border: 2px solid #CBD5E0;
    }
    
    .character-arms {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 20px;
      display: flex;
      justify-content: space-between;
    }
    
    .character-arm {
      width: 20px;
      height: 60px;
      background: linear-gradient(180deg, #F7FAFC 0%, #E2E8F0 100%);
      border-radius: 10px;
      border: 2px solid #CBD5E0;
      transition: all 0.3s ease;
    }
    
    .character-legs {
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 20px;
      display: flex;
      justify-content: space-between;
    }
    
    .character-leg {
      width: 20px;
      height: 60px;
      background: linear-gradient(180deg, #4A5568 0%, #2D3748 100%);
      border-radius: 10px;
      border: 2px solid #1A202C;
      transition: all 0.3s ease;
    }
    
    .character-face {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30px;
      height: 20px;
    }
    
    .character-eyes {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    
    .character-eye {
      width: 6px;
      height: 6px;
      background: #2D3748;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .character-mouth {
      width: 12px;
      height: 4px;
      background: #2D3748;
      border-radius: 0 0 12px 12px;
      margin: 0 auto;
      transition: all 0.3s ease;
    }
    
    /* Character states */
    .character.nervous .character-arms .character-arm {
      transform: rotate(-15deg);
    }
    
    .character.nervous .character-legs .character-leg {
      animation: shake 0.5s infinite;
    }
    
    .character.nervous .character-eye {
      width: 8px;
      height: 4px;
    }
    
    .character.nervous .character-mouth {
      width: 8px;
      height: 2px;
    }
    
    .character.confident .character-arms .character-arm {
      transform: rotate(10deg);
    }
    
    .character.confident .character-head {
      transform: translateX(-50%) rotate(5deg);
    }
    
    .character.confident .character-mouth {
      width: 16px;
      height: 6px;
      border-radius: 0 0 16px 16px;
    }
    
    .character.defensive .character-arms .character-arm {
      transform: rotate(-45deg);
    }
    
    .character.defensive .character-head {
      transform: translateX(-50%) rotate(-5deg);
    }
    
    .character.defensive .character-mouth {
      width: 6px;
      height: 2px;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }
    
    .analysis-panel {
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin: 20px 0;
    }
    
    .analysis-options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    
    .analysis-option {
      background: var(--glass-strong);
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .analysis-option:hover {
      border-color: var(--glow1);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 247, 213, 0.1);
    }
    
    .analysis-option.correct {
      border-color: var(--success);
      background: rgba(74, 222, 128, 0.1);
    }
    
    .analysis-option.incorrect {
      border-color: var(--error);
      background: rgba(248, 113, 113, 0.1);
    }
    
    .option-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--glass);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .option-content {
      flex: 1;
    }
    
    .option-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text);
    }
    
    .option-description {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.4;
    }
    
    .confidence-meter {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
      padding: 15px;
      background: var(--glass);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }
    
    .confidence-bar {
      flex: 1;
      height: 8px;
      background: var(--bg1);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .confidence-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--error), var(--warning), var(--success));
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .confidence-text {
      font-size: 14px;
      color: var(--text-muted);
      min-width: 80px;
      text-align: right;
    }
    
    .quest-phase {
      display: none;
    }
    
    .quest-phase.active {
      display: block;
    }
    
    .phase-indicator {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 20px 0;
    }
    
    .phase-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--border);
      transition: all 0.3s ease;
    }
    
    .phase-dot.active {
      background: var(--glow1);
      transform: scale(1.2);
    }
    
    .phase-dot.completed {
      background: var(--success);
    }
    
    .analysis-complete {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--glass-strong);
      border: 2px solid var(--glow1);
      border-radius: var(--radius);
      padding: 30px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s ease;
      z-index: 20;
      backdrop-filter: blur(20px);
    }
    
    .analysis-complete.show {
      opacity: 1;
      pointer-events: all;
    }
    
    .analysis-icon-large {
      font-size: 48px;
      margin-bottom: 15px;
      animation: analysisBounce 1s infinite;
    }
    
    @keyframes analysisBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .character-state-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--glass-strong);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      font-size: 12px;
      color: var(--text-muted);
      backdrop-filter: blur(10px);
    }
  </style>
</head>
<body>
  <div class="bodylang-quest">
    <div class="app">
      <header class="glass topbar">
        <div class="brand">
          <button id="btnBack" class="btn ghost">‚Üê</button>
          <h1>–Ø–∑—ã–∫ —Ç–µ–ª–∞</h1>
          <div class="badge">–§–∞–∑–∞ <span id="currentPhase">1</span>/3</div>
        </div>
        <div class="actions">
          <button id="btnHelp" class="btn ghost">‚ùì</button>
        </div>
      </header>

      <main class="content">
        <div class="phase-indicator">
          <div class="phase-dot active" data-phase="1"></div>
          <div class="phase-dot" data-phase="2"></div>
          <div class="phase-dot" data-phase="3"></div>
        </div>

        <!-- –§–∞–∑–∞ 1: –ù–∞–±–ª—é–¥–µ–Ω–∏–µ -->
        <div id="phase1" class="quest-phase active">
          <div class="clue-container">
            <h3>üëÅÔ∏è –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º</h3>
            <div class="clue-text">
              –¢—ã –Ω–∞–±–ª—é–¥–∞–µ—à—å –∑–∞ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–º –≤–æ –≤—Ä–µ–º—è –¥–æ–ø—Ä–æ—Å–∞. –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –µ–≥–æ –∂–µ—Å—Ç—ã, 
              –º–∏–º–∏–∫—É –∏ –ø–æ–∑—É. –ß—Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç –æ–∑–Ω–∞—á–∞—Ç—å?
            </div>
            
            <div class="character-container">
              <div class="character-state-indicator">–°–æ—Å—Ç–æ—è–Ω–∏–µ: –ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å</div>
              <div class="character nervous" id="character">
                <div class="character-head">
                  <div class="character-face">
                    <div class="character-eyes">
                      <div class="character-eye"></div>
                      <div class="character-eye"></div>
                    </div>
                    <div class="character-mouth"></div>
                  </div>
                </div>
                <div class="character-body"></div>
                <div class="character-arms">
                  <div class="character-arm"></div>
                  <div class="character-arm"></div>
                </div>
                <div class="character-legs">
                  <div class="character-leg"></div>
                  <div class="character-leg"></div>
                </div>
              </div>
            </div>
            
            <div class="analysis-panel">
              <h4>–ß—Ç–æ —Ç—ã –∑–∞–º–µ—Ç–∏–ª –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏?</h4>
              <div class="analysis-options" id="phase1Options">
                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>
            </div>
          </div>
        </div>

        <!-- –§–∞–∑–∞ 2: –ê–Ω–∞–ª–∏–∑ –¥–µ—Ç–∞–ª–µ–π -->
        <div id="phase2" class="quest-phase">
          <div class="clue-container">
            <h3>üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
            <div class="clue-text">
              –í—ã–±–µ—Ä–∏ –∞—Å–ø–µ–∫—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. 
              –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –¥–∞—Ç—å –≤–∞–∂–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —á–µ–ª–æ–≤–µ–∫–∞.
            </div>
            
            <div class="character-container">
              <div class="character-state-indicator">–°–æ—Å—Ç–æ—è–Ω–∏–µ: <span id="currentState">–ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å</span></div>
              <div class="character nervous" id="character2">
                <div class="character-head">
                  <div class="character-face">
                    <div class="character-eyes">
                      <div class="character-eye"></div>
                      <div class="character-eye"></div>
                    </div>
                    <div class="character-mouth"></div>
                  </div>
                </div>
                <div class="character-body"></div>
                <div class="character-arms">
                  <div class="character-arm"></div>
                  <div class="character-arm"></div>
                </div>
                <div class="character-legs">
                  <div class="character-leg"></div>
                  <div class="character-leg"></div>
                </div>
              </div>
            </div>
            
            <div class="analysis-panel" id="bodyAnalysis" style="display: none;">
              <h4 id="analysisTitle">–ê–Ω–∞–ª–∏–∑</h4>
              <div class="clue-text" id="analysisText"></div>
              <div class="analysis-options" id="phase2Options">
                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>
            </div>
          </div>
        </div>

        <!-- –§–∞–∑–∞ 3: –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ -->
        <div id="phase3" class="quest-phase">
          <div class="clue-container">
            <h3>üß† –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥</h3>
            <div class="clue-text">
              –ù–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö –Ω–∞–±–ª—é–¥–µ–Ω–∏–π —Å–¥–µ–ª–∞–π –≤—ã–≤–æ–¥ –æ —Ç–æ–º, –≥–æ–≤–æ—Ä–∏—Ç –ª–∏ —á–µ–ª–æ–≤–µ–∫ –ø—Ä–∞–≤–¥—É 
              –∏–ª–∏ –ª–∂–µ—Ç. –£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∞–Ω–∞–ª–∏–∑–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å.
            </div>
            
            <div class="confidence-meter">
              <span class="confidence-text">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</span>
              <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceFill"></div>
              </div>
              <span class="confidence-text" id="confidenceText">0%</span>
            </div>
            
            <div class="analysis-panel">
              <h4>–¢–≤–æ–π –≤—ã–≤–æ–¥:</h4>
              <div class="analysis-options" id="phase3Options">
                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>
            </div>
          </div>
        </div>

        <div class="analysis-complete" id="analysisComplete">
          <div class="analysis-icon-large">üß†</div>
          <h3>–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!</h3>
          <p>–¢—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —è–∑—ã–∫ —Ç–µ–ª–∞!</p>
          <div class="questActions">
            <button id="completeBtn" class="btn primary">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–∞
    const QUEST_CONFIG = {
      rewards: { fragments: 2, experience: 60 }
    };

    // –î–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç–∞
    const QUEST_DATA = {
      phase1: {
        question: "–ß—Ç–æ —Ç—ã –∑–∞–º–µ—Ç–∏–ª –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏?",
        options: [
          {
            icon: "üò∞",
            title: "–ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–≤–æ–≥–∞",
            description: "–ß–∞—Å—Ç–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ, –¥—Ä–æ–∂–∞—â–∏–µ —Ä—É–∫–∏, –Ω–µ—É—Å–∏–¥—á–∏–≤–æ—Å—Ç—å",
            correct: true
          },
          {
            icon: "üòå",
            title: "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
            description: "–†–æ–≤–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ, —Å–ø–æ–∫–æ–π–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∞",
            correct: false
          },
          {
            icon: "üò§",
            title: "–ê–≥—Ä–µ—Å—Å–∏—è –∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ",
            description: "–ù–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–µ –º—ã—à—Ü—ã, —Å–∂–∞—Ç—ã–µ –∫—É–ª–∞–∫–∏, —Ä–µ–∑–∫–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è",
            correct: false
          },
          {
            icon: "üòê",
            title: "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑—Ä–∞–∑–ª–∏—á–∏–µ",
            description: "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–º–æ—Ü–∏–π, —Ä–∞–≤–Ω–æ–¥—É—à–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞",
            correct: false
          }
        ]
      },
      phase2: {
        aspects: {
          eyes: {
            title: "–ê–Ω–∞–ª–∏–∑ –≥–ª–∞–∑",
            description: "–ü–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–π —á–∞—Å—Ç–æ –æ—Ç–≤–æ–¥–∏—Ç –≤–∑–≥–ª—è–¥ –∏ –º–æ—Ä–≥–∞–µ—Ç. –≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞...",
            state: "nervous",
            options: [
              {
                icon: "üò®",
                title: "–ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å –∏ –ª–æ–∂—å",
                description: "–ü–æ–ø—ã—Ç–∫–∞ —Å–∫—Ä—ã—Ç—å –ø—Ä–∞–≤–¥—É –∏ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä—è–º–æ–≥–æ –≤–∑–≥–ª—è–¥–∞",
                correct: true
              },
              {
                icon: "üò¥",
                title: "–£—Å—Ç–∞–ª–æ—Å—Ç—å",
                description: "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –Ω–µ–¥–æ—Å—ã–ø–∞–Ω–∏–µ",
                correct: false
              },
              {
                icon: "ü§î",
                title: "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é",
                description: "–ì–ª—É–±–æ–∫–æ–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ –Ω–∞–¥ –≤–æ–ø—Ä–æ—Å–æ–º",
                correct: false
              },
              {
                icon: "üòé",
                title: "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                description: "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞",
                correct: false
              }
            ]
          },
          hands: {
            title: "–ê–Ω–∞–ª–∏–∑ —Ä—É–∫",
            description: "–†—É–∫–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–≤–∏–≥–∞—é—Ç—Å—è, —á–µ–ª–æ–≤–µ–∫ —Ç–µ—Ä–µ–±–∏—Ç –ø—Ä–µ–¥–º–µ—Ç—ã. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç...",
            state: "nervous",
            options: [
              {
                icon: "üò∞",
                title: "–°—Ç—Ä–µ—Å—Å –∏ —Ç—Ä–µ–≤–æ–≥—É",
                description: "–ü–æ–ø—ã—Ç–∫–∞ —Å–Ω—è—Ç—å –Ω–µ—Ä–≤–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",
                correct: true
              },
              {
                icon: "ü§ó",
                title: "–≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å",
                description: "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω–æ—Å—Ç—å",
                correct: false
              },
              {
                icon: "üí™",
                title: "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                description: "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–ª—ã –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è",
                correct: false
              },
              {
                icon: "üòå",
                title: "–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ—Å—Ç—å",
                description: "–ü–æ–ª–Ω–æ–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –∫–æ–º—Ñ–æ—Ä—Ç",
                correct: false
              }
            ]
          },
          posture: {
            title: "–ê–Ω–∞–ª–∏–∑ –ø–æ–∑—ã",
            description: "–ü–æ–∑–∞ –∑–∞–∫—Ä—ã—Ç–∞—è, —Ä—É–∫–∏ —Å–∫—Ä–µ—â–µ–Ω—ã. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç...",
            state: "defensive",
            options: [
              {
                icon: "üõ°Ô∏è",
                title: "–ó–∞—â–∏—Ç—É –∏ –∑–∞–∫—Ä—ã—Ç–æ—Å—Ç—å",
                description: "–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –±–∞—Ä—å–µ—Ä –∏ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è",
                correct: true
              },
              {
                icon: "üòé",
                title: "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                description: "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–ª—ã –∏ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–∞",
                correct: false
              },
              {
                icon: "üòå",
                title: "–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ—Å—Ç—å",
                description: "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–¥–æ–±–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ",
                correct: false
              },
              {
                icon: "ü§ó",
                title: "–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å",
                description: "–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—â–µ–Ω–∏—é –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é",
                correct: false
              }
            ]
          }
        }
      },
      phase3: {
        question: "–¢–≤–æ–π –≤—ã–≤–æ–¥ –æ –ø—Ä–∞–≤–¥–∏–≤–æ—Å—Ç–∏:",
        options: [
          {
            icon: "‚úÖ",
            title: "–ß–µ–ª–æ–≤–µ–∫ –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–∞–≤–¥—É",
            description: "–í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç—å",
            correct: false
          },
          {
            icon: "‚ùå",
            title: "–ß–µ–ª–æ–≤–µ–∫ –ª–∂–µ—Ç",
            description: "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –æ–±–º–∞–Ω–∞",
            correct: true
          },
          {
            icon: "‚ùì",
            title: "–ù–µ –º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å",
            description: "–°–º–µ—à–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã, –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
            correct: false
          },
          {
            icon: "‚è≥",
            title: "–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏",
            description: "–¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
            correct: false
          }
        ]
      }
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
      currentPhase: 1,
      confidence: 0,
      selectedAspects: [],
      currentCharacterState: 'nervous'
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const character = document.getElementById('character');
    const character2 = document.getElementById('character2');
    const currentState = document.getElementById('currentState');
    const btnBack = document.getElementById('btnBack');
    const btnHelp = document.getElementById('btnHelp');
    const completeBtn = document.getElementById('completeBtn');
    const analysisComplete = document.getElementById('analysisComplete');

    // –£—Ç–∏–ª–∏—Ç—ã
    const toast = (msg, type = 'info') => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = `toast ${type}`;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      setupEventListeners();
      loadPhase(1);
    }

    function setupEventListeners() {
      btnBack.addEventListener('click', () => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = '../quests.html';
        }
      });
      btnHelp.addEventListener('click', showHelp);
      completeBtn.addEventListener('click', completeQuest);
    }

    function loadPhase(phase) {
      gameState.currentPhase = phase;
      
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∞–∑—ã
      document.querySelectorAll('.quest-phase').forEach(p => p.classList.remove('active'));
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–∞–∑—É
      document.getElementById(`phase${phase}`).classList.add('active');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–∞–∑
      updatePhaseIndicator(phase);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–∑—ã
      if (phase === 1) {
        loadPhase1();
      } else if (phase === 2) {
        loadPhase2();
      } else if (phase === 3) {
        loadPhase3();
      }
    }

    function updatePhaseIndicator(phase) {
      document.querySelectorAll('.phase-dot').forEach((dot, index) => {
        dot.classList.remove('active', 'completed');
        if (index + 1 < phase) {
          dot.classList.add('completed');
        } else if (index + 1 === phase) {
          dot.classList.add('active');
        }
      });
      
      document.getElementById('currentPhase').textContent = phase;
    }

    function loadPhase1() {
      const container = document.getElementById('phase1Options');
      container.innerHTML = '';
      
      QUEST_DATA.phase1.options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, handlePhase1Answer);
        container.appendChild(optionEl);
      });
    }

    function loadPhase2() {
      gameState.selectedAspects = [];
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞—Å–ø–µ–∫—Ç–æ–≤
      const container = document.getElementById('phase2Options');
      container.innerHTML = '';
      
      Object.entries(QUEST_DATA.phase2.aspects).forEach(([key, aspect]) => {
        const optionEl = createOptionElement({
          icon: getAspectIcon(key),
          title: aspect.title,
          description: aspect.description
        }, key, handleAspectSelect);
        container.appendChild(optionEl);
      });
      
      document.getElementById('bodyAnalysis').style.display = 'none';
    }

    function loadPhase3() {
      const container = document.getElementById('phase3Options');
      container.innerHTML = '';
      
      QUEST_DATA.phase3.options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, handlePhase3Answer);
        container.appendChild(optionEl);
      });
      
      updateConfidence();
    }

    function createOptionElement(option, index, handler) {
      const optionEl = document.createElement('div');
      optionEl.className = 'analysis-option';
      optionEl.innerHTML = `
        <div class="option-icon">${option.icon}</div>
        <div class="option-content">
          <div class="option-title">${option.title}</div>
          <div class="option-description">${option.description}</div>
        </div>
      `;
      optionEl.addEventListener('click', () => handler(index));
      return optionEl;
    }

    function getAspectIcon(aspect) {
      const icons = {
        eyes: 'üëÅÔ∏è',
        hands: '‚úã',
        posture: 'üßç'
      };
      return icons[aspect] || 'üîç';
    }

    function handlePhase1Answer(index) {
      const options = document.querySelectorAll('#phase1Options .analysis-option');
      const correct = QUEST_DATA.phase1.options[index].correct;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(correct ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      if (correct) {
        toast('–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –∞–Ω–∞–ª–∏–∑—É.', 'success');
        setTimeout(() => loadPhase(2), 1500);
      } else {
        toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
        setTimeout(() => {
          options.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
            opt.style.pointerEvents = 'auto';
          });
        }, 2000);
      }
    }

    function handleAspectSelect(aspectKey) {
      const aspect = QUEST_DATA.phase2.aspects[aspectKey];
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
      updateCharacterState(aspect.state);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∞–ª–∏–∑
      const analysisPanel = document.getElementById('bodyAnalysis');
      const analysisTitle = document.getElementById('analysisTitle');
      const analysisText = document.getElementById('analysisText');
      const analysisOptions = document.getElementById('phase2Options');
      
      analysisTitle.textContent = aspect.title;
      analysisText.textContent = aspect.description;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞—Å–ø–µ–∫—Ç–∞
      analysisOptions.innerHTML = '';
      aspect.options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, (i) => handleAspectAnswer(i, aspectKey));
        analysisOptions.appendChild(optionEl);
      });
      
      analysisPanel.style.display = 'block';
    }

    function handleAspectAnswer(index, aspectKey) {
      const options = document.querySelectorAll('#phase2Options .analysis-option');
      const correct = QUEST_DATA.phase2.aspects[aspectKey].options[index].correct;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(correct ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      if (correct) {
        gameState.selectedAspects.push(aspectKey);
        gameState.confidence += 25;
        toast('–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑! +25% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏', 'success');
        
        if (gameState.selectedAspects.length >= 2) {
          setTimeout(() => loadPhase(3), 1500);
        } else {
          setTimeout(() => {
            document.getElementById('bodyAnalysis').style.display = 'none';
            loadPhase2(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–∑—É 2
          }, 2000);
        }
      } else {
        gameState.confidence = Math.max(0, gameState.confidence - 10);
        toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑! -10% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏', 'error');
        setTimeout(() => {
          options.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
            opt.style.pointerEvents = 'auto';
          });
        }, 2000);
      }
      
      updateConfidence();
    }

    function handlePhase3Answer(index) {
      const options = document.querySelectorAll('#phase3Options .analysis-option');
      const correct = QUEST_DATA.phase3.options[index].correct;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(correct ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      if (correct) {
        toast('–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥! –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
        setTimeout(() => {
          analysisComplete.classList.add('show');
        }, 1500);
      } else {
        toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
        setTimeout(() => {
          options.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
            opt.style.pointerEvents = 'auto';
          });
        }, 2000);
      }
    }

    function updateCharacterState(state) {
      gameState.currentCharacterState = state;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
      [character, character2].forEach(char => {
        char.className = `character ${state}`;
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
      const stateTexts = {
        nervous: '–ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å',
        confident: '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å',
        defensive: '–ó–∞—â–∏—Ç–∞'
      };
      currentState.textContent = stateTexts[state] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    }

    function updateConfidence() {
      const confidenceFill = document.getElementById('confidenceFill');
      const confidenceText = document.getElementById('confidenceText');
      
      confidenceFill.style.width = `${gameState.confidence}%`;
      confidenceText.textContent = `${gameState.confidence}%`;
    }

    function showHelp() {
      toast('–ù–∞–±–ª—é–¥–∞–π –∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –¥–µ–ª–∞–π –≤—ã–≤–æ–¥—ã!', 'info');
    }

    function completeQuest() {
      toast('–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ö–∞–±...', 'success');
      setTimeout(() => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = '../quests.html';
        }
      }, 1500);
    }

    // –ó–∞–ø—É—Å–∫
    init();
  </script>
</body>
</html>
