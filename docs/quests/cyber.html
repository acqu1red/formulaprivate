<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–ö–∏–±–µ—Ä-–≤–∑–ª–æ–º ‚Äî –ö–≤–µ—Å—Ç‚Äë–•–∞–±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../quests.css" />
  <style>
    .cyber-quest {
      position: relative;
      min-height: 100vh;
      background: linear-gradient(135deg, #0B1020 0%, #1A2332 100%);
      overflow: hidden;
    }
    
    .terminal {
      background: var(--bg0);
      border: 2px solid var(--glow1);
      border-radius: var(--radius);
      padding: 20px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.4;
      color: var(--glow1);
      height: 300px;
      overflow-y: auto;
      margin: 20px 0;
      position: relative;
    }
    
    .terminal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(90deg, var(--glow1), var(--glow2));
      border-radius: var(--radius) var(--radius) 0 0;
      opacity: 0.1;
    }
    
    .terminal-line {
      margin: 2px 0;
      animation: typewriter 0.1s ease-out;
    }
    
    .terminal-line.success { color: var(--success); }
    .terminal-line.error { color: var(--error); }
    .terminal-line.warning { color: var(--warning); }
    .terminal-line.info { color: var(--glow2); }
    
    @keyframes typewriter {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .code-block {
      background: var(--bg1);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 15px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: var(--text);
      position: relative;
      overflow-x: auto;
    }
    
    .code-line {
      margin: 2px 0;
      padding: 2px 8px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    
    .code-line:hover {
      background: var(--glass);
    }
    
    .code-line.correct {
      background: rgba(74, 222, 128, 0.1);
      border-left: 3px solid var(--success);
    }
    
    .code-line.incorrect {
      background: rgba(248, 113, 113, 0.1);
      border-left: 3px solid var(--error);
    }
    
    .hack-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin: 20px 0;
    }
    
    .hack-cell {
      aspect-ratio: 1;
      background: var(--glass);
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .hack-cell:hover {
      border-color: var(--glow1);
      transform: scale(1.05);
    }
    
    .hack-cell.correct {
      background: rgba(74, 222, 128, 0.2);
      border-color: var(--success);
      color: var(--success);
    }
    
    .hack-cell.incorrect {
      background: rgba(248, 113, 113, 0.2);
      border-color: var(--error);
      color: var(--error);
    }
    
    .hack-cell::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(102, 247, 213, 0.3) 50%, transparent 70%);
      transform: translateX(-100%);
      transition: transform 0.5s ease;
    }
    
    .hack-cell:hover::before {
      transform: translateX(100%);
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg1);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--glow1), var(--glow2));
      width: 0%;
      transition: width 0.5s ease;
      position: relative;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: progressShine 2s infinite;
    }
    
    @keyframes progressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .security-level {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
      padding: 10px;
      background: var(--glass);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }
    
    .security-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--error);
      animation: pulse 1s infinite;
    }
    
    .security-indicator.medium { background: var(--warning); }
    .security-indicator.low { background: var(--success); }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .quest-phase {
      display: none;
    }
    
    .quest-phase.active {
      display: block;
    }
    
    .phase-indicator {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 20px 0;
    }
    
    .phase-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--border);
      transition: all 0.3s ease;
    }
    
    .phase-dot.active {
      background: var(--glow1);
      transform: scale(1.2);
    }
    
    .phase-dot.completed {
      background: var(--success);
    }
    
    .hack-complete {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--glass-strong);
      border: 2px solid var(--glow1);
      border-radius: var(--radius);
      padding: 30px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s ease;
      z-index: 20;
      backdrop-filter: blur(20px);
    }
    
    .hack-complete.show {
      opacity: 1;
      pointer-events: all;
    }
    
    .hack-icon {
      font-size: 48px;
      margin-bottom: 15px;
      animation: hackBounce 1s infinite;
    }
    
    @keyframes hackBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .analysis-options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    
    .analysis-option {
      background: var(--glass-strong);
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .analysis-option:hover {
      border-color: var(--glow1);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 247, 213, 0.1);
    }
    
    .analysis-option.correct {
      border-color: var(--success);
      background: rgba(74, 222, 128, 0.1);
    }
    
    .analysis-option.incorrect {
      border-color: var(--error);
      background: rgba(248, 113, 113, 0.1);
    }
    
    .option-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--glass);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .option-content {
      flex: 1;
    }
    
    .option-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text);
    }
    
    .option-description {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="cyber-quest">
    <div class="app">
      <header class="glass topbar">
        <div class="brand">
          <button id="btnBack" class="btn ghost">‚Üê</button>
          <h1>–ö–∏–±–µ—Ä-–≤–∑–ª–æ–º</h1>
          <div class="badge">–§–∞–∑–∞ <span id="currentPhase">1</span>/3</div>
        </div>
        <div class="actions">
          <button id="btnHelp" class="btn ghost">‚ùì</button>
        </div>
      </header>

      <main class="content">
        <div class="phase-indicator">
          <div class="phase-dot active" data-phase="1"></div>
          <div class="phase-dot" data-phase="2"></div>
          <div class="phase-dot" data-phase="3"></div>
        </div>

        <!-- –§–∞–∑–∞ 1: –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã -->
        <div id="phase1" class="quest-phase active">
          <div class="clue-container">
            <h3>üîç –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
            <div class="clue-text">
              –¢—ã –ø—Ä–æ–Ω–∏–∫ –≤ —Å–∏—Å—Ç–µ–º—É –±–∞–Ω–∫–∞. –ù—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–π—Ç–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏.
              –ò–∑—É—á–∏ –∫–æ–¥ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏ –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π.
            </div>
            
            <div class="terminal" id="terminal1">
              <div class="terminal-line">$ ./security_scan.sh</div>
              <div class="terminal-line">Scanning system vulnerabilities...</div>
              <div class="terminal-line">Found 3 potential entry points</div>
              <div class="terminal-line">Analyzing code structure...</div>
            </div>
            
            <div class="code-block">
              <div class="code-line">function validateAccess(user, token) {</div>
              <div class="code-line">  if (user.role === 'admin') return true;</div>
              <div class="code-line">  if (token.expires < Date.now()) return false;</div>
              <div class="code-line">  return checkPermissions(user.id);</div>
              <div class="code-line">}</div>
            </div>
            
            <div class="analysis-options" id="phase1Options">
              <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>
        </div>

        <!-- –§–∞–∑–∞ 2: –í–∑–ª–æ–º –ø–∞—Ä–æ–ª—è -->
        <div id="phase2" class="quest-phase">
          <div class="clue-container">
            <h3>üîê –í–∑–ª–æ–º –ø–∞—Ä–æ–ª—è</h3>
            <div class="clue-text">
              –ù—É–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø–∞—Ä–æ–ª—è.
              –ö–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –∏–º–µ–µ—Ç —Å–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
            </div>
            
            <div class="security-level">
              <div class="security-indicator" id="securityLevel"></div>
              <span>–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: <span id="securityText">–í—ã—Å–æ–∫–∏–π</span></span>
            </div>
            
            <div class="hack-grid" id="hackGrid">
              <!-- –°–µ—Ç–∫–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="progress-bar">
              <div class="progress-fill" id="hackProgress"></div>
            </div>
            
            <div class="terminal" id="terminal2">
              <div class="terminal-line">$ ./password_crack.py</div>
              <div class="terminal-line">Attempting brute force attack...</div>
            </div>
          </div>
        </div>

        <!-- –§–∞–∑–∞ 3: –û–±—Ö–æ–¥ —Ñ–∞–π—Ä–≤–æ–ª–∞ -->
        <div id="phase3" class="quest-phase">
          <div class="clue-container">
            <h3>üõ°Ô∏è –û–±—Ö–æ–¥ —Ñ–∞–π—Ä–≤–æ–ª–∞</h3>
            <div class="clue-text">
              –§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø! –ù—É–∂–Ω–æ –æ–±–æ–π—Ç–∏ —Ñ–∞–π—Ä–≤–æ–ª, –≤—ã–±—Ä–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.
              –ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä –≤–ª–∏—è–µ—Ç –Ω–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤–∑–ª–æ–º–∞.
            </div>
            
            <div class="terminal" id="terminal3">
              <div class="terminal-line">$ ./firewall_bypass.sh</div>
              <div class="terminal-line">Detecting firewall rules...</div>
              <div class="terminal-line">Available ports: 22, 80, 443, 8080</div>
            </div>
            
            <div class="analysis-options" id="phase3Options">
              <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>
        </div>

        <div class="hack-complete" id="hackComplete">
          <div class="hack-icon">üíª</div>
          <h3>–ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h3>
          <p>–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –≤–∑–ª–æ–º–∞–Ω–∞.</p>
          <div style="background: var(--glass); border-radius: var(--radius-sm); padding: 16px; margin: 16px 0;">
            <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 8px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: 700; color: var(--glow1);">+5</div>
                <div style="font-size: 12px; color: var(--text-muted);">Mulacoin</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: 700; color: var(--glow2);">+1000</div>
                <div style="font-size: 12px; color: var(--text-muted);">–û–ø—ã—Ç–∞</div>
              </div>
            </div>
          </div>
          <p style="font-size: 14px; color: var(--text-muted); margin-top: 16px;">
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –ø–æ –∫–Ω–æ–ø–∫–µ "–ò—Å—Ç–æ—Ä–∏—è"
          </p>
          <div class="questActions">
            <button id="completeBtn" class="btn primary">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–∞
    const QUEST_CONFIG = {
      maxAttempts: 3,
      hackDuration: 2000,
      rewards: { fragments: 3, experience: 80 }
    };

    // –î–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç–∞
    const QUEST_DATA = {
      phase1: {
        question: "–ö–∞–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –∫–æ–¥–µ?",
        options: [
          {
            icon: "üîë",
            title: "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞",
            description: "–¢–æ–∫–µ–Ω –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º",
            correct: false
          },
          {
            icon: "üëë",
            title: "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–∏",
            description: "–ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞",
            correct: true
          },
          {
            icon: "üîí",
            title: "–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è",
            description: "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è",
            correct: false
          },
          {
            icon: "üìù",
            title: "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è",
            description: "–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è",
            correct: false
          }
        ]
      },
      phase2: {
        password: "H4CK3R",
        symbols: ["H", "4", "C", "K", "3", "R", "X", "9", "Z", "1", "A", "7", "M", "5", "P", "2"],
        correctSequence: [0, 1, 2, 3, 4, 5]
      },
      phase3: {
        question: "–ö–∞–∫–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–±—Ö–æ–¥–∞?",
        options: [
          {
            icon: "üîê",
            title: "SSH (–ø–æ—Ä—Ç 22)",
            description: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞",
            correct: false
          },
          {
            icon: "üåê",
            title: "HTTP (–ø–æ—Ä—Ç 80)",
            description: "–û–±—ã—á–Ω—ã–π –≤–µ–±-–ø—Ä–æ—Ç–æ–∫–æ–ª –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è",
            correct: false
          },
          {
            icon: "üîí",
            title: "HTTPS (–ø–æ—Ä—Ç 443)",
            description: "–ó–∞—â–∏—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Å SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º",
            correct: true
          },
          {
            icon: "üîÑ",
            title: "HTTP Proxy (–ø–æ—Ä—Ç 8080)",
            description: "–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π",
            correct: false
          }
        ]
      }
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
      currentPhase: 1,
      attempts: 0,
      progress: 0,
      isRunning: false,
      selectedCells: []
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const terminal1 = document.getElementById('terminal1');
    const terminal2 = document.getElementById('terminal2');
    const terminal3 = document.getElementById('terminal3');
    const hackGrid = document.getElementById('hackGrid');
    const hackProgress = document.getElementById('hackProgress');
    const securityLevel = document.getElementById('securityLevel');
    const securityText = document.getElementById('securityText');
    const btnBack = document.getElementById('btnBack');
    const btnHelp = document.getElementById('btnHelp');
    const completeBtn = document.getElementById('completeBtn');
    const hackComplete = document.getElementById('hackComplete');

    // –£—Ç–∏–ª–∏—Ç—ã
    const toast = (msg, type = 'info') => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = `toast ${type}`;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    };

    const addTerminalLine = (terminal, text, type = '') => {
      const line = document.createElement('div');
      line.className = `terminal-line ${type}`;
      line.textContent = text;
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      setupEventListeners();
      loadPhase(1);
    }

    function setupEventListeners() {
      btnBack.addEventListener('click', () => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = '../quests.html';
        }
      });
      btnHelp.addEventListener('click', showHelp);
      completeBtn.addEventListener('click', completeQuest);
    }

    function loadPhase(phase) {
      gameState.currentPhase = phase;
      
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∞–∑—ã
      document.querySelectorAll('.quest-phase').forEach(p => p.classList.remove('active'));
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–∞–∑—É
      document.getElementById(`phase${phase}`).classList.add('active');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–∞–∑
      updatePhaseIndicator(phase);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–∑—ã
      if (phase === 1) {
        loadPhase1();
      } else if (phase === 2) {
        loadPhase2();
      } else if (phase === 3) {
        loadPhase3();
      }
    }

    function updatePhaseIndicator(phase) {
      document.querySelectorAll('.phase-dot').forEach((dot, index) => {
        dot.classList.remove('active', 'completed');
        if (index + 1 < phase) {
          dot.classList.add('completed');
        } else if (index + 1 === phase) {
          dot.classList.add('active');
        }
      });
      
      document.getElementById('currentPhase').textContent = phase;
    }

    function loadPhase1() {
      const container = document.getElementById('phase1Options');
      container.innerHTML = '';
      
      QUEST_DATA.phase1.options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, handlePhase1Answer);
        container.appendChild(optionEl);
      });
    }

    function loadPhase2() {
      // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –¥–ª—è –≤–∑–ª–æ–º–∞ –ø–∞—Ä–æ–ª—è
      hackGrid.innerHTML = '';
      gameState.selectedCells = [];
      gameState.progress = 0;
      
      QUEST_DATA.phase2.symbols.forEach((symbol, index) => {
        const cell = document.createElement('div');
        cell.className = 'hack-cell';
        cell.textContent = symbol;
        cell.dataset.index = index;
        cell.addEventListener('click', () => handleCellClick(cell, index));
        hackGrid.appendChild(cell);
      });
      
      updateSecurityLevel();
      updateHackProgress();
    }

    function loadPhase3() {
      const container = document.getElementById('phase3Options');
      container.innerHTML = '';
      
      QUEST_DATA.phase3.options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, handlePhase3Answer);
        container.appendChild(optionEl);
      });
    }

    function createOptionElement(option, index, handler) {
      const optionEl = document.createElement('div');
      optionEl.className = 'analysis-option';
      optionEl.innerHTML = `
        <div class="option-icon">${option.icon}</div>
        <div class="option-content">
          <div class="option-title">${option.title}</div>
          <div class="option-description">${option.description}</div>
        </div>
      `;
      optionEl.addEventListener('click', () => handler(index));
      return optionEl;
    }

    function handlePhase1Answer(index) {
      const options = document.querySelectorAll('#phase1Options .analysis-option');
      const correct = QUEST_DATA.phase1.options[index].correct;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(correct ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      addTerminalLine(terminal1, correct ? 'Vulnerability found!' : 'Incorrect analysis', correct ? 'success' : 'error');
      
      if (correct) {
        toast('–£—è–∑–≤–∏–º–æ—Å—Ç—å –Ω–∞–π–¥–µ–Ω–∞! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤–∑–ª–æ–º—É –ø–∞—Ä–æ–ª—è.', 'success');
        setTimeout(() => loadPhase(2), 1500);
      } else {
        toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
        setTimeout(() => {
          options.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
            opt.style.pointerEvents = 'auto';
          });
        }, 2000);
      }
    }

    function handleCellClick(cell, index) {
      if (gameState.selectedCells.includes(index)) return;
      
      gameState.selectedCells.push(index);
      cell.classList.add('correct');
      
      const symbol = QUEST_DATA.phase2.symbols[index];
      addTerminalLine(terminal2, `Trying symbol: ${symbol}`, 'info');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      const currentSequence = gameState.selectedCells.slice(-6);
      const isCorrect = currentSequence.length === 6 && 
        currentSequence.every((cellIndex, i) => 
          QUEST_DATA.phase2.symbols[cellIndex] === QUEST_DATA.phase2.password[i]
        );
      
      if (isCorrect) {
        addTerminalLine(terminal2, 'Password cracked successfully!', 'success');
        toast('–ü–∞—Ä–æ–ª—å –≤–∑–ª–æ–º–∞–Ω! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–∞–π—Ä–≤–æ–ª—É.', 'success');
        setTimeout(() => loadPhase(3), 1500);
      } else if (currentSequence.length === 6) {
        // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
        addTerminalLine(terminal2, 'Wrong password sequence!', 'error');
        gameState.selectedCells = [];
        document.querySelectorAll('.hack-cell').forEach(c => c.classList.remove('correct'));
        toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
      }
      
      updateHackProgress();
    }

    function handlePhase3Answer(index) {
      const options = document.querySelectorAll('#phase3Options .analysis-option');
      const correct = QUEST_DATA.phase3.options[index].correct;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(correct ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      addTerminalLine(terminal3, correct ? 'Firewall bypassed!' : 'Firewall blocked access', correct ? 'success' : 'error');
      
      if (correct) {
        toast('–§–∞–π—Ä–≤–æ–ª –æ–±–æ–π–¥–µ–Ω! –í–∑–ª–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
        setTimeout(() => {
          hackComplete.classList.add('show');
        }, 1500);
      } else {
        toast('–§–∞–π—Ä–≤–æ–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
        setTimeout(() => {
          options.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
            opt.style.pointerEvents = 'auto';
          });
        }, 2000);
      }
    }

    function updateSecurityLevel() {
      const progress = gameState.progress;
      if (progress < 30) {
        securityLevel.className = 'security-indicator';
        securityText.textContent = '–í—ã—Å–æ–∫–∏–π';
      } else if (progress < 70) {
        securityLevel.className = 'security-indicator medium';
        securityText.textContent = '–°—Ä–µ–¥–Ω–∏–π';
      } else {
        securityLevel.className = 'security-indicator low';
        securityText.textContent = '–ù–∏–∑–∫–∏–π';
      }
    }

    function updateHackProgress() {
      const progress = (gameState.selectedCells.length / 6) * 100;
      gameState.progress = progress;
      hackProgress.style.width = `${progress}%`;
      updateSecurityLevel();
    }

    function showHelp() {
      toast('–ò–∑—É—á–∏ –∫–æ–¥, –ø–æ–¥–±–µ—Ä–∏ –ø–∞—Ä–æ–ª—å –∏ –æ–±–æ–π–¥–∏ —Ñ–∞–π—Ä–≤–æ–ª!', 'info');
    }

    function completeQuest() {
      toast('–í–∑–ª–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω! –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ö–∞–±...', 'success');
      setTimeout(() => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = '../quests.html';
        }
      }, 1500);
    }

    // –ó–∞–ø—É—Å–∫
    init();
  </script>
</body>
</html>
