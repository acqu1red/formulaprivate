<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–û—Å—Ç—Ä–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ - 3D Premium</title>
    
    <!-- Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Three.js –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å fallback -->
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ —Å fallback
        function loadScript(src, fallbackSrc, callback) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = callback;
            script.onerror = function() {
                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å:', src);
                if (fallbackSrc) {
                    console.log('üîÑ –ü—Ä–æ–±—É–µ–º fallback:', fallbackSrc);
                    const fallbackScript = document.createElement('script');
                    fallbackScript.src = fallbackSrc;
                    fallbackScript.onload = callback;
                    fallbackScript.onerror = function() {
                        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–∂–µ fallback:', fallbackSrc);
                        callback(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É'));
                    };
                    document.head.appendChild(fallbackScript);
                } else {
                    callback(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É'));
                }
            };
            document.head.appendChild(script);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ Three.js —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ fallback
        loadScript(
            'https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js',
            'https://unpkg.com/three@0.158.0/build/three.min.js',
            function(error) {
                if (error) {
                    console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Three.js');
                    document.body.innerHTML = '<div style="padding: 20px; text-align: center; color: white; background: #1a1a1a; height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column;"><h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2><p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Three.js. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.</p><button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button></div>';
                } else {
                    console.log('‚úÖ Three.js –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ—Å–ª–µ Three.js
                    loadThreeExtensions();
                }
            }
        );

        function loadThreeExtensions() {
            // OrbitControls - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL
            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/controls/OrbitControls.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js',
                function() { 
                    console.log('‚úÖ OrbitControls –∑–∞–≥—Ä—É–∂–µ–Ω');
                    // –î–µ–ª–∞–µ–º OrbitControls –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ
                    if (typeof THREE !== 'undefined' && typeof THREE.OrbitControls === 'undefined') {
                        THREE.OrbitControls = window.OrbitControls;
                    }
                }
            );

            // GLTFLoader
            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/GLTFLoader.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/loaders/GLTFLoader.js',
                function() { console.log('‚úÖ GLTFLoader –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            // DRACOLoader
            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/DRACOLoader.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/loaders/DRACOLoader.js',
                function() { console.log('‚úÖ DRACOLoader –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            // Post-processing
            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/postprocessing/EffectComposer.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/postprocessing/EffectComposer.js',
                function() { console.log('‚úÖ EffectComposer –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/postprocessing/RenderPass.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/postprocessing/RenderPass.js',
                function() { console.log('‚úÖ RenderPass –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/postprocessing/ShaderPass.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/postprocessing/ShaderPass.js',
                function() { console.log('‚úÖ ShaderPass –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/postprocessing/UnrealBloomPass.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/postprocessing/UnrealBloomPass.js',
                function() { console.log('‚úÖ UnrealBloomPass –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/postprocessing/OutputPass.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/postprocessing/OutputPass.js',
                function() { console.log('‚úÖ OutputPass –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/shaders/CopyShader.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/shaders/CopyShader.js',
                function() { console.log('‚úÖ CopyShader –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );

            loadScript(
                'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/shaders/LuminosityHighPassShader.js',
                'https://unpkg.com/three@0.158.0/examples/jsm/shaders/LuminosityHighPassShader.js',
                function() { console.log('‚úÖ LuminosityHighPassShader –∑–∞–≥—Ä—É–∂–µ–Ω'); }
            );
        }
    </script>
    
    <!-- –ê–Ω–∏–º–∞—Ü–∏–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- –£—Ç–∏–ª–∏—Ç—ã -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/4.0.2/simplex-noise.min.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/navigation-island.css">
</head>
<body>
    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div class="preloader-content">
            <div class="preloader-logo">
                <div class="logo-icon">üèùÔ∏è</div>
                <div class="logo-text">–û—Å—Ç—Ä–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</div>
            </div>
            <div class="preloader-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∏—Ä–∞...</div>
            </div>
            <div class="preloader-tips">
                <div class="tip" id="loadingTip">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ 3D –¥–≤–∏–∂–∫–∞...</div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Ç—Ä–æ –æ–∫–Ω–æ -->
    <div class="intro-overlay" id="introOverlay">
        <div class="intro-content">
            <button class="intro-close" id="introClose">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
            <div class="intro-header">
                <div class="intro-icon">üèùÔ∏è</div>
                <div class="intro-title">–û—Å—Ç—Ä–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</div>
                <div class="intro-subtitle">Premium 3D Experience</div>
            </div>
            <div class="intro-text">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç—Ä–µ—Ö–º–µ—Ä–Ω—ã–π –º–∏—Ä –∑–Ω–∞–Ω–∏–π!<br><br>
                –ü–µ—Ä–µ–¥ –≤–∞–º–∏ –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤ —Å –ø—è—Ç—å—é –¥—Ä–µ–≤–Ω–∏–º–∏ —Ö—Ä–∞–º–∞–º–∏, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –º—É–¥—Ä–æ—Å—Ç—å.<br><br>
                <strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong><br>
                üñ±Ô∏è <strong>–î–µ—Å–∫—Ç–æ–ø:</strong> –ú—ã—à—å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –∫–ª–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞<br>
                üì± <strong>–ú–æ–±–∏–ª—å–Ω—ã–µ:</strong> –ö–∞—Å–∞–Ω–∏—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –≤—ã–±–æ—Ä–∞<br><br>
                –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ 3D –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...
            </div>
            <div class="intro-features">
                <div class="feature">
                    <span class="feature-icon">‚ú®</span>
                    <span class="feature-text">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è 3D –≥—Ä–∞—Ñ–∏–∫–∞</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">üéÆ</span>
                    <span class="feature-text">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">üì±</span>
                    <span class="feature-text">–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 3D Scene Container -->
    <div id="scene-container"></div>

    <!-- UI Overlay -->
    <div class="ui-overlay">
        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div class="instructions" id="instructions">
            <div class="instruction-icon">üéØ</div>
            <div class="instruction-text">–ù–∞–∂–º–∏ –Ω–∞ —Ö—Ä–∞–º –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã</div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="info-panel" id="infoPanel">
            <div class="info-header">
                <div class="info-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                <button class="info-toggle" id="infoToggle">‚àí</button>
            </div>
            <div class="info-content" id="infoContent">
                <div class="control-group">
                    <div class="control-title">üñ±Ô∏è –î–µ—Å–∫—Ç–æ–ø</div>
                    <div class="control-item">–õ–ö–ú - –≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã</div>
                    <div class="control-item">–ü–ö–ú - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</div>
                    <div class="control-item">–ö–æ–ª–µ—Å–æ - –∑—É–º</div>
                </div>
                <div class="control-group">
                    <div class="control-title">üì± –ú–æ–±–∏–ª—å–Ω—ã–µ</div>
                    <div class="control-item">–û–¥–∏–Ω –ø–∞–ª–µ—Ü - –≤—Ä–∞—â–µ–Ω–∏–µ</div>
                    <div class="control-item">–î–≤–∞ –ø–∞–ª—å—Ü–∞ - –∑—É–º</div>
                    <div class="control-item">–ö–∞—Å–∞–Ω–∏–µ - –≤—ã–±–æ—Ä</div>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
        <button class="back-button hidden" id="backButton">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            <span>–ù–∞–∑–∞–¥</span>
        </button>

        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
        <div class="mobile-controls" id="mobileControls">
            <button class="mobile-btn" id="mobileZoomIn">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
            </button>
            <button class="mobile-btn" id="mobileZoomOut">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13H5v-2h14v2z"/>
                </svg>
            </button>
            <button class="mobile-btn" id="mobileReset">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                </svg>
            </button>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
        <div class="performance-panel" id="performancePanel">
            <div class="fps-counter" id="fpsCounter">60 FPS</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <div class="modal-content" id="modalContent">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notifications" id="notifications">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
        let librariesLoaded = {
            three: false,
            tween: false,
            gsap: false
        };

        function checkLibraries() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...');
            
            if (typeof THREE !== 'undefined') {
                librariesLoaded.three = true;
                console.log('‚úÖ Three.js –∑–∞–≥—Ä—É–∂–µ–Ω');
            } else {
                console.error('‚ùå Three.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            }
            
            if (typeof TWEEN !== 'undefined') {
                librariesLoaded.tween = true;
                console.log('‚úÖ TWEEN.js –∑–∞–≥—Ä—É–∂–µ–Ω');
            } else {
                console.warn('‚ö†Ô∏è TWEEN.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            if (typeof gsap !== 'undefined') {
                librariesLoaded.gsap = true;
                console.log('‚úÖ GSAP –∑–∞–≥—Ä—É–∂–µ–Ω');
            } else {
                console.warn('‚ö†Ô∏è GSAP –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }

            // –ï—Å–ª–∏ Three.js –∑–∞–≥—Ä—É–∂–µ–Ω, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            if (librariesLoaded.three && !window.isAppInitialized) {
                console.log('‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                if (window.initApp) {
                    window.isAppInitialized = true;
                    window.initApp();
                }
            } else if (!librariesLoaded.three) {
                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                setTimeout(checkLibraries, 1000);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
            setTimeout(checkLibraries, 500);
        });
    </script>
    
    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
