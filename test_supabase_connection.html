<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</h1>
        
        <div class="test-section info">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏</h3>
            <p><strong>URL:</strong> <span id="supabaseUrl"></span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="connectionStatus">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span></p>
        </div>

        <div class="test-section">
            <h3>üë§ –¢–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <p>Telegram ID –¥–ª—è —Ç–µ—Å—Ç–∞: <input type="number" id="testTelegramId" value="123456789" style="width: 150px;"></p>
            <button onclick="testCreateUser()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button onclick="testLoadUser()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button onclick="testUpdateUser()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
            <button onclick="testDeleteUser()">–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <div id="userResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üéØ –¢–µ—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∫–≤–µ—Å—Ç–æ–≤</h3>
            <button onclick="testQuestHistory()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é –∫–≤–µ—Å—Ç–æ–≤</button>
            <button onclick="testLoadQuestHistory()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–≤–µ—Å—Ç–æ–≤</button>
            <div id="questResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üé∞ –¢–µ—Å—Ç —Ä—É–ª–µ—Ç–∫–∏</h3>
            <button onclick="testRouletteHistory()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é —Ä—É–ª–µ—Ç–∫–∏</button>
            <button onclick="testLoadRouletteHistory()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä—É–ª–µ—Ç–∫–∏</button>
            <div id="rouletteResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üé´ –¢–µ—Å—Ç –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</h3>
            <button onclick="testCreatePromocode()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
            <button onclick="testLoadPromocodes()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã</button>
            <div id="promocodeResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üßπ –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
            <button onclick="cleanupTestData()">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <div id="cleanupResult" class="result"></div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_URL = "https://uhhsrtmmuwoxsdquimaa.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoaHNydG1tdXdveHNkcXVpbWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2OTMwMzcsImV4cCI6MjA3MDI2OTAzN30.5xxo6g-GEYh4ufTibaAtbgrifPIU_ilzGzolAdmAnm8";

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
        document.getElementById('supabaseUrl').textContent = SUPABASE_URL;
        document.getElementById('connectionStatus').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
        document.getElementById('connectionStatus').style.color = 'green';

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        async function testCreateUser() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('userResult');
            
            try {
                const { data, error } = await supabase
                    .from('bot_user')
                    .upsert({
                        telegram_id: telegramId,
                        username: 'test_user',
                        first_name: 'Test',
                        last_name: 'User',
                        mulacoin: 100,
                        experience: 500,
                        level: 2
                    })
                    .select();

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª–µ–Ω:\n${JSON.stringify(data[0], null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testLoadUser() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('userResult');
            
            try {
                const { data, error } = await supabase
                    .from('bot_user')
                    .select('*')
                    .eq('telegram_id', telegramId)
                    .single();

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testUpdateUser() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('userResult');
            
            try {
                const { data, error } = await supabase
                    .from('bot_user')
                    .update({
                        mulacoin: 200,
                        experience: 1000,
                        level: 3,
                        updated_at: new Date().toISOString()
                    })
                    .eq('telegram_id', telegramId)
                    .select();

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω:\n${JSON.stringify(data[0], null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testDeleteUser() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('userResult');
            
            try {
                const { error } = await supabase
                    .from('bot_user')
                    .delete()
                    .eq('telegram_id', telegramId);

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∫–≤–µ—Å—Ç–æ–≤
        async function testQuestHistory() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('questResult');
            
            try {
                const { data, error } = await supabase
                    .from('quest_history')
                    .insert({
                        user_id: telegramId,
                        quest_id: 'test_quest',
                        quest_name: '–¢–µ—Å—Ç–æ–≤—ã–π –∫–≤–µ—Å—Ç',
                        difficulty: 'medium',
                        mulacoin_earned: 3,
                        experience_earned: 500
                    })
                    .select();

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ó–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∫–≤–µ—Å—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–∞:\n${JSON.stringify(data[0], null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testLoadQuestHistory() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('questResult');
            
            try {
                const { data, error } = await supabase
                    .from('quest_history')
                    .select('*')
                    .eq('user_id', telegramId);

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∫–≤–µ—Å—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Ä—É–ª–µ—Ç–∫–∏
        async function testRouletteHistory() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('rouletteResult');
            
            try {
                const { data, error } = await supabase
                    .from('roulette_history')
                    .insert({
                        user_id: telegramId,
                        prize_type: 'discount',
                        prize_name: '–°–∫–∏–¥–∫–∞ 100 —Ä—É–±–ª–µ–π',
                        is_free: false,
                        mulacoin_spent: 13
                    })
                    .select();

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ó–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ä—É–ª–µ—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞:\n${JSON.stringify(data[0], null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testLoadRouletteHistory() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('rouletteResult');
            
            try {
                const { data, error } = await supabase
                    .from('roulette_history')
                    .select('*')
                    .eq('user_id', telegramId);

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ä—É–ª–µ—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
        async function testCreatePromocode() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('promocodeResult');
            
            try {
                const { data, error } = await supabase
                    .from('promocodes')
                    .insert({
                        code: 'TEST' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                        type: 'discount',
                        value: 100,
                        issued_to: telegramId,
                        expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
                    })
                    .select();

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω:\n${JSON.stringify(data[0], null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testLoadPromocodes() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('promocodeResult');
            
            try {
                const { data, error } = await supabase
                    .from('promocodes')
                    .select('*')
                    .eq('issued_to', telegramId);

                if (error) throw error;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function cleanupTestData() {
            const telegramId = parseInt(document.getElementById('testTelegramId').value);
            const resultDiv = document.getElementById('cleanupResult');
            
            try {
                // –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
                await supabase.from('roulette_history').delete().eq('user_id', telegramId);
                await supabase.from('quest_history').delete().eq('user_id', telegramId);
                await supabase.from('promocodes').delete().eq('issued_to', telegramId);
                await supabase.from('bot_user').delete().eq('telegram_id', telegramId);
                
                resultDiv.className = 'result success';
                resultDiv.textContent = '‚úÖ –í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
    </script>
</body>
</html>
