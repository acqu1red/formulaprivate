# Telegram Bot —Å —Å–∏—Å—Ç–µ–º–æ–π –æ–ø–ª–∞—Ç—ã Lava Top

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram –±–æ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º—ã –æ–ø–ª–∞—Ç—ã Lava Top –∏ Telegram Mini Apps.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Telegram Mini Apps** - —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Lava Top –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–ø–ª–∞—Ç—É
- ‚úÖ **Webhook —Å–∏—Å—Ç–µ–º–∞** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ–ø–ª–∞—Ç–µ
- ‚úÖ **Supabase –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **Railway –¥–µ–ø–ª–æ–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Railway Dashboard –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
LAVA_SHOP_ID=1b9f3e05-86aa-4102-9648-268f0f586bb1
LAVA_SECRET_KEY=whjKvjpi2oqAjTOwfbt0YUkulXCxjU5PWUJDxlQXwOuhOCNSiRq2jSX7Gd2Zihav
LAVA_PRODUCT_ID=302ecdcd-1581-45ad-8353-a168f347b8cc
SUPABASE_URL=https://uhhsrtmmuwoxsdquimaa.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoaHNydG1tdXdveHNkcXVpbWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2OTMwMzcsImV4cCI6MjA3MDI2OTAzN30.5xxo6g-GEYh4ufTibaAtbgrifPIU_ilzGzolAdmAnm8
WEBHOOK_SECRET=Telegram_Webhook_Secret_2024_Formula_Bot_7a6b5c
LAVA_WEBHOOK_SECRET=LavaTop_Webhook_Secret_2024_Formula_Private_Channel_8x9y2z
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Lava Top

1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Lava Top —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook:
   - **URL**: `https://formulaprivate-productionpaymentuknow.up.railway.app/lava-webhook`
   - **API Key**: `LavaTop_Webhook_Secret_2024_Formula_Private_Channel_8x9y2z`

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Product ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `302ecdcd-1581-45ad-8353-a168f347b8cc`

### 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Railway

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Railway
2. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ –∏ –Ω–∞–∂–∏–º–∞–µ—Ç `/start`
2. **–ë–æ—Ç** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Mini Apps
4. **Mini Apps** —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (email, —Ç–∞—Ä–∏—Ñ, —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã)
5. **–î–∞–Ω–Ω—ã–µ** –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –±–æ—Ç —á–µ—Ä–µ–∑ `tg.sendData`
6. **–ë–æ—Ç** —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Lava Top
7. **–ë–æ—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å"
8. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
9. **Lava Top** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
10. **–ë–æ—Ç** –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Telegram Mini Apps ‚Üí tg.sendData ‚Üí Bot Webhook ‚Üí API Endpoint ‚Üí Lava Top ‚Üí Payment URL
                                                                              ‚Üì
Lava Top Webhook ‚Üê Bot Webhook ‚Üê Payment Success ‚Üê Lava Top ‚Üê User Payment
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ bot_webhook.py          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞ —Å webhook
‚îú‚îÄ‚îÄ payment.html            # Mini Apps –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ index.html              # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Mini Apps
‚îú‚îÄ‚îÄ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ railway.toml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Railway
‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß API Endpoints

### `/webhook` - Telegram Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**: –ö–æ–º–∞–Ω–¥—ã, —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –æ—Ç Mini Apps

### `/api/create-payment` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- **–ú–µ—Ç–æ–¥**: POST
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É
- **–î–∞–Ω–Ω—ã–µ**: `{"user_id": "123", "email": "test@example.com", "tariff": "1_month", "price": 50.0}`
- **–û—Ç–≤–µ—Ç**: `{"status": "success", "payment_url": "https://app.lava.top/..."}`

### `/lava-webhook` - Lava Top Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –æ—Ç Lava Top
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**: –£—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏

### `/health` - Health Check
- **–ú–µ—Ç–æ–¥**: GET
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

## üé® Mini Apps

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```javascript
// –î–∞–Ω–Ω—ã–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∏–∑ Mini Apps
{
  "step": "final_data",
  "email": "user@example.com",
  "tariff": "1_month",
  "price": 50.0,
  "userId": "123456789"
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:

```javascript
// –í Mini Apps
tg.sendData(JSON.stringify({
  step: "final_data",
  email: email,
  tariff: tariff,
  price: price,
  userId: userId
}));
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `subscriptions`:
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- `email` - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `tariff` - –¢–∞—Ä–∏—Ñ –ø–æ–¥–ø–∏—Å–∫–∏
- `amount` - –°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã
- `currency` - –í–∞–ª—é—Ç–∞
- `order_id` - ID –∑–∞–∫–∞–∑–∞
- `start_date` - –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- `end_date` - –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- `status` - –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
- `metadata` - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üöÄ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/payment` - –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –æ–ø–ª–∞—Ç—ã
- `/more_info` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:

```
üöÄ –í–´–ó–í–ê–ù–ê –§–£–ù–ö–¶–ò–Ø handle_web_app_data!
üéØ –û–ë–†–ê–ë–û–¢–ö–ê –§–ò–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•!
‚úÖ –ò–ù–í–û–ô–° –°–û–ó–î–ê–ù –£–°–ü–ï–®–ù–û!
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "Chat not found"
- **–ü—Ä–∏—á–∏–Ω–∞**: –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ chat_id
- **–†–µ—à–µ–Ω–∏–µ**: –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–∫–∏–µ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL –∏ secret token
- **–õ–æ–≥–∏**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å LAVA_SHOP_ID –∏ LAVA_PRODUCT_ID
- **API**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ `/api/create-payment` endpoint

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –≤ Lava Top

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:
- –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞
- –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –≤ Mini Apps
- –ü–æ–ª—É—á–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É
- –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
- –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É

**–£–¥–∞—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!** üöÄ
