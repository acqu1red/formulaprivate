# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞ MiniApp ‚Üí Railway ‚Üí LAVA TOP

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **Procfile** - –Ω–µ–±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
```diff
- web: python bot_webhook.py
+ web: python -u bot_webhook.py
```

### 2. **bot_webhook.py** - —É–±—Ä–∞–Ω—ã —Ö–∞—Ä–¥–∫–æ–¥—ã
- ‚ùå –£–±—Ä–∞–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á—É–∂–æ–≥–æ –¥–æ–º–µ–Ω–∞ `PUBLIC_BASE_URL`
- ‚ùå –£–±—Ä–∞–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–ª—é—á–∏ `LAVA_TOP_API_KEY`, `TELEGRAM_BOT_TOKEN`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `metadata.tg_user_id` –≤ LAVA –∏–Ω–≤–æ–π—Å—ã –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ webhook (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–æ–≤ –¥–æ–º–µ–Ω–æ–≤)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints `/reset-webhook` –∏ `/webhook-info`

### 3. **docs/payment.html** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –£–±—Ä–∞–Ω–∞ –≥–æ–Ω–∫–∞ `tg.close()` ‚Üí `tg.sendData()`
- ‚úÖ –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Ç–æ–º –∑–∞–∫—Ä—ã—Ç–∏–µ MiniApp
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è email
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –±–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏—è MiniApp

### 4. **env.example** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚ùå –£–±—Ä–∞–Ω—ã –≤—Å–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ Railway

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
PRIVATE_CHANNEL_ID=-1001234567890

# LAVA TOP Seller API
LAVA_TOP_API_KEY=–≤–∞—à_–∫–ª—é—á_lava_top
LAVA_OFFER_ID_BASIC=302ecdcd-1581-45ad-8353-a168f347b8cc

# Railway URL (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é)
PUBLIC_BASE_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω-railway.up.railway.app

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
ADMIN_IDS=123,456
LAVA_TOP_WEBHOOK_SECRET=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç_–≤–µ–±—Ö—É–∫–∞
```

### 2. –î–µ–ø–ª–æ–π

```bash
git add .
git commit -m "Fix payment flow: remove hardcoded values, fix webhook logic"
git push
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –°–±—Ä–æ—Å –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω-railway.up.railway.app/reset-webhook

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
curl https://–≤–∞—à-–¥–æ–º–µ–Ω-railway.up.railway.app/webhook-info
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LAVA TOP webhook

–í –∫–∞–±–∏–Ω–µ—Ç–µ app.lava.top —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook URL:
```
https://–≤–∞—à-–¥–æ–º–µ–Ω-railway.up.railway.app/lava-webhook
```

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. MiniApp –ø—É—Ç—å
1. –û—Ç–∫—Ä–æ–π—Ç–µ MiniApp –≤ –±–æ—Ç–µ
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ email –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ
3. –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å"
4. –í —á–∞—Ç–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –æ–ø–ª–∞—Ç—É

### 2. REST API –ø—É—Ç—å
```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω-railway.up.railway.app/api/create-payment \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 123,
    "email": "user@example.com",
    "tariff": "basic",
    "price": 50,
    "bank": "russian"
  }'
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "payment_url": "https://app.lava.top/...",
  "message": "Payment created successfully"
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
–õ–æ–≥–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥—è—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏):
```bash
# –í Railway Dashboard –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –≤—Å–µ print() —Å–æ–æ–±—â–µ–Ω–∏—è
```

## üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- ‚úÖ `Procfile` - –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `-u`
- ‚úÖ `bot_webhook.py` - —É–±—Ä–∞–Ω—ã —Ö–∞—Ä–¥–∫–æ–¥—ã, –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ `docs/payment.html` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `env.example` - —É–±—Ä–∞–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏

### –§–∞–π–ª—ã –ù–ï –∏–∑–º–µ–Ω–µ–Ω—ã:
- ‚ùå –û—Å—Ç–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞
- ‚ùå –ú–µ–Ω—é –∏ –∫–æ–º–∞–Ω–¥—ã
- ‚ùå Supabase –ª–æ–≥–∏–∫–∞ (–≤–Ω–µ –æ–ø–ª–∞—Ç—ã)
- ‚ùå –¢–µ–∫—Å—Ç—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚ùå –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –î–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç—ã

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –∫–ª—é—á–∏ —Ç–µ–ø–µ—Ä—å –±–µ—Ä—É—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–æ–≤ –¥–æ–º–µ–Ω–æ–≤ –≤ –∫–æ–¥–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–Ω–≤–æ–π—Å–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìã –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway
- [ ] –î–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- [ ] Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (`/reset-webhook`)
- [ ] Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç (`/webhook-info`)
- [ ] LAVA TOP webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –∫–∞–±–∏–Ω–µ—Ç–µ
- [ ] MiniApp –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ò–Ω–≤–æ–π—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ LAVA TOP Seller API
- [ ] –ò–Ω–≤–∞–π—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### "LAVA_TOP_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `LAVA_TOP_API_KEY` –≤ Railway

### "PUBLIC_BASE_URL –Ω–µ –∑–∞–¥–∞–Ω"
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `PUBLIC_BASE_URL` –≤ Railway
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ `/reset-webhook`

### "Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN`
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ `/reset-webhook`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/webhook-info`

### "MiniApp –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `tg.sendData()` –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ `payment.html`
