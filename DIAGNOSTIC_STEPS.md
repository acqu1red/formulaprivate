# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –ª–æ–≥–∏ –æ—Ç Telegram webhook

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ Railway
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Variables**
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–¥–∞–Ω—ã –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
WEBHOOK_URL=https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app
WEBHOOK_SECRET=–ª—é–±–∞—è_—Å—Ç—Ä–æ–∫–∞_—Å–µ–∫—Ä–µ—Ç–∞
LAVA_TOP_API_KEY=–≤–∞—à_–∫–ª—é—á_lava_top
LAVA_OFFER_ID_BASIC=302ecdcd-1581-45ad-8353-a168f347b8cc
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤ –ª–æ–≥–∞—Ö Railway –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:

```
üöÄ –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
üì° WEBHOOK_URL: https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app
ü§ñ TELEGRAM_BOT_TOKEN: 7593...6qc
üîë LAVA_TOP_API_KEY: whjK...hav
üéØ LAVA_OFFER_ID_BASIC: 302e...b8cc
üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM –ë–û–¢–ê
üîó –£–°–¢–ê–ù–û–í–ö–ê WEBHOOK
üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π webhook...
‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ webhook: 200
üéØ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º webhook: https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/webhook
üì° setWebhook –æ—Ç–≤–µ—Ç: 200 {"ok":true,"result":true,"description":"Webhook was set"}
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON:
```json
{
  "status": "ok",
  "time": "2024-01-01T12:00:00Z",
  "webhook_url": "https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app",
  "bot_token_set": true,
  "lava_key_set": true
}
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook info

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/webhook-info
```

–í –æ—Ç–≤–µ—Ç–µ `result.url` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
```
https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/webhook
```

### –®–∞–≥ 5: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
python debug_webhook.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–æ—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫—É webhook
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint

### –®–∞–≥ 6: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook

–ï—Å–ª–∏ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```
POST https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/force-set-webhook
```

### –®–∞–≥ 7: –¢–µ—Å—Ç –±–æ—Ç–∞

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û–ø–ª–∞—Ç–∏—Ç—å"
3. –í –ª–æ–≥–∞—Ö Railway –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
HTTP IN: {"method":"POST","path":"/webhook","ip":"...","ct":"application/json","len":"123","json":{...}}
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π WEBHOOK_URL
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à–µ —Ç–µ–∫—É—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞—Ä—ã–π –¥–æ–º–µ–Ω `formulaprivate-productionpaymentuknow.up.railway.app`

### 2. –ù–µ –∑–∞–¥–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### 3. Telegram –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ webhook
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –∏–∑–≤–Ω–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å SSL
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç SSL
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `https://`

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health
curl https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook info
curl https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/webhook-info

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
curl -X POST https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.up.railway.app/force-set-webhook
```

## –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Procfile –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `web: python bot_webhook_app.py`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏—Ç—å polling: `USE_POLLING=1`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
